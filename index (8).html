<html lang="id" class="scroll-smooth" >
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LawLink - Jasa Hukum & Notaris Digital</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
<style>
  /* Custom scrollbar for chat */
  .chat-scroll::-webkit-scrollbar {
    width: 6px;
  }
  .chat-scroll::-webkit-scrollbar-thumb {
    background-color: #3F51B5;
    border-radius: 3px;
  }
  .fade-enter {
    opacity: 0;
    transform: translateX(20px);
  }
  .fade-enter-active {
    opacity: 1;
    transform: translateX(0);
    transition: opacity 300ms, transform 300ms;
  }
  .fade-exit {
    opacity: 1;
    transform: translateX(0);
  }
  .fade-exit-active {
    opacity: 0;
    transform: translateX(-20px);
    transition: opacity 300ms, transform 300ms;
  }
</style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen flex flex-col">

<div id="app" class="flex-grow flex flex-col">
  <!-- Pages will be injected here -->
</div>

<script>
(() => {
  // Constants
  const PRIMARY_COLOR = '#3F51B5';
  const ACCENT_COLOR = '#FFD700';

  // Data storage keys
  const STORAGE_KEYS = {
    USERS: 'lawlink_users',
    SESSION: 'lawlink_session',
    APPOINTMENTS: 'lawlink_appointments',
    DOCUMENTS: 'lawlink_documents',
    CHATS: 'lawlink_chats',
    BLOGS: 'lawlink_blogs',
    LAWYERS: 'lawlink_lawyers',
    NOTARIS: 'lawlink_notaris',
  };

  // Initial data for lawyers, notaris, blogs
  const initialLawyers = [
    {
      id: 'lawyer1',
      name: 'Andi Prasetyo',
      specialization: 'Hukum Perdata',
      photo: 'pengacara1.png',
    },
    {
      id: 'lawyer2',
      name: 'Sari Dewi',
      specialization: 'Hukum Pidana',
      photo: 'https://placehold.co/150x150/png?text=Sari+Dewi',
    },
    {
      id: 'lawyer3',
      name: 'Budi Santoso',
      specialization: 'Hukum Bisnis',
      photo: 'https://placehold.co/150x150/png?text=Budi+Santoso',
    },
    {
      id: 'lawyer4',
      name: 'Rina Wulandari',
      specialization: 'Hukum Keluarga',
      photo: 'https://placehold.co/150x150/png?text=Rina+Wulandari',
    },
  ];

  const initialNotaris = [
    {
      id: 'notaris1',
      name: 'Dewi Lestari',
      specialization: 'Akta Notaris',
      photo: 'https://placehold.co/150x150/png?text=Dewi+Lestari',
    },
    {
      id: 'notaris2',
      name: 'Agus Santoso',
      specialization: 'PPAT & Legalisasi',
      photo: 'https://placehold.co/150x150/png?text=Agus+Santoso',
    },
  ];

  const initialBlogs = [
    {
      id: 'blog1',
      title: 'Prosedur Pembuatan Surat Kuasa',
      preview: 'Langkah-langkah mudah untuk membuat surat kuasa secara legal.',
      thumbnail: 'https://placehold.co/400x250/png?text=Surat+Kuasa',
      content: 'Surat kuasa adalah dokumen penting yang memberikan wewenang kepada seseorang untuk bertindak atas nama orang lain. Berikut adalah prosedur pembuatan surat kuasa yang legal dan sah...',
    },
    {
      id: 'blog2',
      title: 'Tips Memilih Lawyer Profesional',
      preview: 'Cara memilih lawyer yang tepat untuk kebutuhan hukum Anda.',
      thumbnail: 'https://placehold.co/400x250/png?text=Tips+Lawyer',
      content: 'Memilih lawyer yang tepat sangat penting untuk keberhasilan kasus Anda. Berikut beberapa tips memilih lawyer profesional yang dapat dipercaya...',
    },
    {
      id: 'blog3',
      title: 'Manfaat Jasa Notaris untuk Dokumen Anda',
      preview: 'Kenali manfaat menggunakan jasa notaris dalam pengurusan dokumen legal.',
      thumbnail: 'https://placehold.co/400x250/png?text=Jasa+Notaris',
      content: 'Notaris memiliki peran penting dalam pengesahan dokumen legal. Berikut manfaat menggunakan jasa notaris untuk memastikan dokumen Anda sah dan aman...',
    },
  ];

  // Utility functions
  function saveToStorage(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }
  function loadFromStorage(key) {
    const data = localStorage.getItem(key);
    if (!data) return null;
    try {
      return JSON.parse(data);
    } catch {
      return null;
    }
  }
  function generateId(prefix = '') {
    return prefix + Math.random().toString(36).substr(2, 9);
  }
  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }
  function validatePhone(phone) {
    const re = /^[0-9]{6,15}$/;
    return re.test(phone);
  }
  function validatePassword(password) {
    // Minimum 8 chars, at least one uppercase, one lowercase, one number
    const re = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
    return re.test(password);
  }
  function debounce(func, wait) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }
  function formatDate(date) {
    return date.toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  function formatTime(date) {
    return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
  }
  function isEmailOrPhone(value) {
    return validateEmail(value) || validatePhone(value);
  }
  function createElementFromHTML(htmlString) {
    const div = document.createElement('div');
    div.innerHTML = htmlString.trim();
    return div.firstChild;
  }
  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // Session timeout (15 minutes inactivity)
  let inactivityTimer;
  function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
      alert('Sesi Anda telah habis karena tidak aktif selama 15 menit. Anda akan logout.');
      logoutUser();
    }, 15 * 60 * 1000);
  }
  document.addEventListener('mousemove', resetInactivityTimer);
  document.addEventListener('keydown', resetInactivityTimer);
  document.addEventListener('click', resetInactivityTimer);

  // Global app state
  let appState = {
    currentPage: 'splash', // splash, onboarding, login, register, main
    onboardingSlide: 0,
    session: null,
    users: [],
    appointments: [],
    documents: [],
    chats: [],
    blogs: [],
    lawyers: [],
    notaris: [],
    currentChatUserId: null,
    currentChatWithId: null,
    currentChatWithRole: null,
    currentMainTab: null,
    currentConsultationTab: 'booking', // booking, schedule, chat
    currentNotarisTab: 'list', // list, form, tracking
    currentDocumentTab: 'gallery', // gallery, request, mydocs
  };

  // Load initial data or from storage
  function loadInitialData() {
    let users = loadFromStorage(STORAGE_KEYS.USERS);
    if (!users) {
      users = [];
      saveToStorage(STORAGE_KEYS.USERS, users);
    }
    appState.users = users;

    let appointments = loadFromStorage(STORAGE_KEYS.APPOINTMENTS);
    if (!appointments) {
      appointments = [];
      saveToStorage(STORAGE_KEYS.APPOINTMENTS, appointments);
    }
    appState.appointments = appointments;

    let documents = loadFromStorage(STORAGE_KEYS.DOCUMENTS);
    if (!documents) {
      documents = [];
      saveToStorage(STORAGE_KEYS.DOCUMENTS, documents);
    }
    appState.documents = documents;

    let chats = loadFromStorage(STORAGE_KEYS.CHATS);
    if (!chats) {
      chats = [];
      saveToStorage(STORAGE_KEYS.CHATS, chats);
    }
    appState.chats = chats;

    let blogs = loadFromStorage(STORAGE_KEYS.BLOGS);
    if (!blogs) {
      blogs = initialBlogs;
      saveToStorage(STORAGE_KEYS.BLOGS, blogs);
    }
    appState.blogs = blogs;

    let lawyers = loadFromStorage(STORAGE_KEYS.LAWYERS);
    if (!lawyers) {
      lawyers = initialLawyers;
      saveToStorage(STORAGE_KEYS.LAWYERS, lawyers);
    }
    appState.lawyers = lawyers;

    let notaris = loadFromStorage(STORAGE_KEYS.NOTARIS);
    if (!notaris) {
      notaris = initialNotaris;
      saveToStorage(STORAGE_KEYS.NOTARIS, notaris);
    }
    appState.notaris = notaris;

    let session = loadFromStorage(STORAGE_KEYS.SESSION);
    if (session && session.userId) {
      const user = users.find(u => u.id === session.userId);
      if (user) {
        appState.session = session;
      } else {
        localStorage.removeItem(STORAGE_KEYS.SESSION);
      }
    }
  }

  // Save session
  function saveSession(user) {
    const session = {
      userId: user.id,
      lastActive: Date.now(),
    };
    appState.session = session;
    saveToStorage(STORAGE_KEYS.SESSION, session);
  }

  // Clear session
  function clearSession() {
    appState.session = null;
    localStorage.removeItem(STORAGE_KEYS.SESSION);
  }

  // Logout user
  function logoutUser() {
    clearSession();
    appState.currentPage = 'login';
    renderApp();
  }

  // Routing system
  function navigateTo(page, options = {}) {
    appState.currentPage = page;
    if (page === 'onboarding' && typeof options.slide === 'number') {
      appState.onboardingSlide = options.slide;
    }
    if (page === 'main' && options.tab) {
      appState.currentMainTab = options.tab;
    }
    if (page === 'consultation' && options.tab) {
      appState.currentConsultationTab = options.tab;
    }
    if (page === 'notaris' && options.tab) {
      appState.currentNotarisTab = options.tab;
    }
    if (page === 'documents' && options.tab) {
      appState.currentDocumentTab = options.tab;
    }
    if (page === 'chat' && options.withId) {
      appState.currentChatWithId = options.withId;
      appState.currentChatWithRole = options.withRole || null;
    }
    scrollToTop();
    renderApp();
  }

  // Helper: get current user
  function getCurrentUser() {
    if (!appState.session) return null;
    return appState.users.find(u => u.id === appState.session.userId) || null;
  }

  // Helper: get user by id
  function getUserById(id) {
    return appState.users.find(u => u.id === id) || null;
  }

  // Helper: get lawyer/notaris by id
  function getLawyerById(id) {
    return appState.lawyers.find(l => l.id === id) || null;
  }
  function getNotarisById(id) {
    return appState.notaris.find(n => n.id === id) || null;
  }

  // Helper: get chat history between two users
  function getChatHistory(userId1, userId2) {
    return appState.chats.filter(c =>
      (c.from === userId1 && c.to === userId2) ||
      (c.from === userId2 && c.to === userId1)
    ).sort((a,b) => a.timestamp - b.timestamp);
  }

  // Save chat message
  function saveChatMessage(from, to, message) {
    const chat = {
      id: generateId('chat_'),
      from,
      to,
      message,
      timestamp: Date.now(),
    };
    appState.chats.push(chat);
    saveToStorage(STORAGE_KEYS.CHATS, appState.chats);
  }

  // Save user data
  function saveUsers() {
    saveToStorage(STORAGE_KEYS.USERS, appState.users);
  }

  // Save appointments
  function saveAppointments() {
    saveToStorage(STORAGE_KEYS.APPOINTMENTS, appState.appointments);
  }

  // Save documents
  function saveDocuments() {
    saveToStorage(STORAGE_KEYS.DOCUMENTS, appState.documents);
  }

  // Render functions for each page

  // 1. Splash Screen
  function renderSplash() {
    const container = document.createElement('div');
    container.className = 'flex flex-col items-center justify-center h-screen bg-white';

    const logo = document.createElement('img');
    logo.src = 'https://placehold.co/150x150/png?text=LawLink+Logo';
    logo.alt = 'Logo aplikasi LawLink, placeholder logo berwarna biru dan emas dengan tulisan LawLink';
    logo.className = 'w-36 h-36 mb-8';

    const spinner = document.createElement('div');
    spinner.className = 'w-12 h-12 border-4 border-t-[#3F51B5] border-gray-300 rounded-full animate-spin';

    container.appendChild(logo);
    container.appendChild(spinner);

    // After 3 seconds redirect to onboarding
    setTimeout(() => {
      navigateTo('onboarding', { slide: 0 });
    }, 3000);

    return container;
  }

  // 2. Onboarding (3 slides)
  function renderOnboarding() {
    const slides = [
      {
        title: 'Solusi Hukum & Notaris Digital',
        description: 'Nikmati kemudahan layanan hukum dan notaris secara digital dengan LawLink.',
        image: 'https://placehold.co/400x300/png?text=Ilustrasi+Hukum+Digital',
        alt: 'Ilustrasi digital hukum dengan simbol timbangan keadilan dan dokumen digital',
      },
      {
        title: 'Konsultasi Lawyer & Notaris Profesional',
        description: 'Konsultasi langsung dengan lawyer dan notaris berpengalaman kapan saja.',
        image: 'https://placehold.co/400x300/png?text=Ikon+Konsultasi+Profesional',
        alt: 'Ikon dua orang sedang berdiskusi dengan latar belakang simbol hukum',
      },
      {
        title: 'Dokumen Legal & Akta Notaris',
        description: 'Akses dan kelola dokumen legal serta akta notaris dengan mudah dan aman.',
        image: 'https://placehold.co/400x300/png?text=Ikon+Dokumen+Legal',
        alt: 'Ikon dokumen legal dengan segel resmi dan pena',
      },
    ];

    const container = document.createElement('div');
    container.className = 'flex flex-col h-screen bg-white p-6';

    // Slide container
    const slideContainer = document.createElement('div');
    slideContainer.className = 'flex-grow flex flex-col items-center justify-center text-center';

    // Image
    const img = document.createElement('img');
    img.src = slides[appState.onboardingSlide].image;
    img.alt = slides[appState.onboardingSlide].alt;
    img.className = 'w-64 h-48 object-contain mb-6 mx-auto';

    // Title
    const title = document.createElement('h2');
    title.textContent = slides[appState.onboardingSlide].title;
    title.className = 'text-2xl font-semibold text-[#3F51B5] mb-2';

    // Description
    const desc = document.createElement('p');
    desc.textContent = slides[appState.onboardingSlide].description;
    desc.className = 'text-gray-700 max-w-md mx-auto';

    slideContainer.appendChild(img);
    slideContainer.appendChild(title);
    slideContainer.appendChild(desc);

    // Navigation dots
    const dotsContainer = document.createElement('div');
    dotsContainer.className = 'flex justify-center space-x-3 mt-6 mb-4';
    slides.forEach((_, i) => {
      const dot = document.createElement('button');
      dot.className = `w-3 h-3 rounded-full ${i === appState.onboardingSlide ? 'bg-[#3F51B5]' : 'bg-gray-300'}`;
      dot.setAttribute('aria-label', `Slide ${i + 1}`);
      dot.addEventListener('click', () => {
        appState.onboardingSlide = i;
        renderApp();
      });
      dotsContainer.appendChild(dot);
    });

    // Buttons container
    const buttonsContainer = document.createElement('div');
    buttonsContainer.className = 'flex justify-between';

    // Skip button
    const skipBtn = document.createElement('button');
    skipBtn.textContent = 'Skip';
    skipBtn.className = 'text-[#3F51B5] font-semibold px-4 py-2 rounded hover:bg-[#3F51B5]/10 transition';
    skipBtn.addEventListener('click', () => {
      navigateTo('login');
    });

    // Next or Get Started button
    const nextBtn = document.createElement('button');
    nextBtn.className = 'bg-[#3F51B5] text-white font-semibold px-4 py-2 rounded hover:bg-[#334296] transition';

    if (appState.onboardingSlide === slides.length - 1) {
      nextBtn.textContent = 'Get Started';
      nextBtn.addEventListener('click', () => {
        navigateTo('login');
      });
    } else {
      nextBtn.textContent = 'Next';
      nextBtn.addEventListener('click', () => {
        appState.onboardingSlide++;
        renderApp();
      });
    }

    buttonsContainer.appendChild(skipBtn);
    buttonsContainer.appendChild(nextBtn);

    container.appendChild(slideContainer);
    container.appendChild(dotsContainer);
    container.appendChild(buttonsContainer);

    return container;
  }

  // 3. Authentication: Login & Register
  function renderLogin() {
    const container = document.createElement('div');
    container.className = 'max-w-md mx-auto p-6 bg-white rounded shadow mt-12 mb-12';

    const title = document.createElement('h1');
    title.textContent = 'Masuk ke LawLink';
    title.className = 'text-3xl font-bold text-[#3F51B5] mb-6 text-center';

    // Form
    const form = document.createElement('form');
    form.className = 'space-y-5';

    // Email/Phone input
    const emailPhoneGroup = document.createElement('div');
    const emailPhoneLabel = document.createElement('label');
    emailPhoneLabel.textContent = 'Email atau Nomor Telepon';
    emailPhoneLabel.className = 'block mb-1 font-semibold';
    const emailPhoneInput = document.createElement('input');
    emailPhoneInput.type = 'text';
    emailPhoneInput.placeholder = 'Masukkan email atau nomor telepon';
    emailPhoneInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    emailPhoneInput.required = true;
    emailPhoneInput.autocomplete = 'username';
    emailPhoneGroup.appendChild(emailPhoneLabel);
    emailPhoneGroup.appendChild(emailPhoneInput);

    // Validation message
    const emailPhoneError = document.createElement('p');
    emailPhoneError.className = 'text-red-600 text-sm mt-1 hidden';
    emailPhoneGroup.appendChild(emailPhoneError);

    // Password input with show/hide toggle
    const passwordGroup = document.createElement('div');
    const passwordLabel = document.createElement('label');
    passwordLabel.textContent = 'Password';
    passwordLabel.className = 'block mb-1 font-semibold';
    const passwordWrapper = document.createElement('div');
    passwordWrapper.className = 'relative';
    const passwordInput = document.createElement('input');
    passwordInput.type = 'password';
    passwordInput.placeholder = 'Masukkan password';
    passwordInput.className = 'w-full border border-gray-300 rounded px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    passwordInput.required = true;
    passwordInput.autocomplete = 'current-password';
    const toggleBtn = document.createElement('button');
    toggleBtn.type = 'button';
    toggleBtn.className = 'absolute right-2 top-2.5 text-gray-500 hover:text-[#3F51B5] focus:outline-none';
    toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
    toggleBtn.addEventListener('click', () => {
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
      } else {
        passwordInput.type = 'password';
        toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
      }
    });
    passwordWrapper.appendChild(passwordInput);
    passwordWrapper.appendChild(toggleBtn);
    passwordGroup.appendChild(passwordLabel);
    passwordGroup.appendChild(passwordWrapper);

    // Validation message
    const passwordError = document.createElement('p');
    passwordError.className = 'text-red-600 text-sm mt-1 hidden';
    passwordGroup.appendChild(passwordError);

    // Submit button
    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Masuk';
    submitBtn.className = 'w-full bg-[#3F51B5] text-white font-semibold py-2 rounded hover:bg-[#334296] transition flex justify-center items-center';
    // Loading spinner inside button
    const spinner = document.createElement('span');
    spinner.className = 'hidden spinner-border spinner-border-sm animate-spin ml-2 border-2 border-white border-t-transparent rounded-full w-5 h-5';
    submitBtn.appendChild(spinner);

    // Links container
    const linksContainer = document.createElement('div');
    linksContainer.className = 'flex justify-between mt-4 text-sm';

    const forgotLink = document.createElement('a');
    forgotLink.href = '#';
    forgotLink.textContent = 'Lupa password?';
    forgotLink.className = 'text-[#3F51B5] hover:underline cursor-pointer';
    forgotLink.addEventListener('click', (e) => {
      e.preventDefault();
      alert('Fitur lupa password belum tersedia.');
    });

    const registerLink = document.createElement('a');
    registerLink.href = '#';
    registerLink.textContent = 'Belum punya akun? Daftar';
    registerLink.className = 'text-[#3F51B5] hover:underline cursor-pointer';
    registerLink.addEventListener('click', (e) => {
      e.preventDefault();
      navigateTo('register');
    });

    linksContainer.appendChild(forgotLink);
    linksContainer.appendChild(registerLink);

    form.appendChild(emailPhoneGroup);
    form.appendChild(passwordGroup);
    form.appendChild(submitBtn);
    form.appendChild(linksContainer);

    // Validation & submit handler
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      emailPhoneError.classList.add('hidden');
      passwordError.classList.add('hidden');

      const emailPhoneVal = emailPhoneInput.value.trim();
      const passwordVal = passwordInput.value;

      if (!isEmailOrPhone(emailPhoneVal)) {
        emailPhoneError.textContent = 'Masukkan email atau nomor telepon yang valid.';
        emailPhoneError.classList.remove('hidden');
        return;
      }
      if (!passwordVal) {
        passwordError.textContent = 'Password wajib diisi.';
        passwordError.classList.remove('hidden');
        return;
      }

      // Show loading
      submitBtn.disabled = true;
      spinner.classList.remove('hidden');

      // Simulate async login
      setTimeout(() => {
        // Find user by email or phone
        const user = appState.users.find(u =>
          (u.email === emailPhoneVal || u.phone === emailPhoneVal) && u.password === passwordVal
        );
        if (!user) {
          alert('Email/Telepon atau password salah.');
          submitBtn.disabled = false;
          spinner.classList.add('hidden');
          return;
        }
        saveSession(user);
        appState.currentMainTab = null;
        navigateTo('main');
      }, 1200);
    });

    container.appendChild(title);
    container.appendChild(form);

    return container;
  }

  function renderRegister() {
    const container = document.createElement('div');
    container.className = 'max-w-md mx-auto p-6 bg-white rounded shadow mt-12 mb-12';

    const title = document.createElement('h1');
    title.textContent = 'Daftar Akun LawLink';
    title.className = 'text-3xl font-bold text-[#3F51B5] mb-6 text-center';

    // Form
    const form = document.createElement('form');
    form.className = 'space-y-5';

    // Nama lengkap
    const nameGroup = document.createElement('div');
    const nameLabel = document.createElement('label');
    nameLabel.textContent = 'Nama Lengkap';
    nameLabel.className = 'block mb-1 font-semibold';
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.placeholder = 'Masukkan nama lengkap';
    nameInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    nameInput.required = true;
    nameGroup.appendChild(nameLabel);
    nameGroup.appendChild(nameInput);
    const nameError = document.createElement('p');
    nameError.className = 'text-red-600 text-sm mt-1 hidden';
    nameGroup.appendChild(nameError);

    // Email/Phone
    const emailPhoneGroup = document.createElement('div');
    const emailPhoneLabel = document.createElement('label');
    emailPhoneLabel.textContent = 'Email atau Nomor Telepon';
    emailPhoneLabel.className = 'block mb-1 font-semibold';
    const emailPhoneInput = document.createElement('input');
    emailPhoneInput.type = 'text';
    emailPhoneInput.placeholder = 'Masukkan email atau nomor telepon';
    emailPhoneInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    emailPhoneInput.required = true;
    emailPhoneGroup.appendChild(emailPhoneLabel);
    emailPhoneGroup.appendChild(emailPhoneInput);
    const emailPhoneError = document.createElement('p');
    emailPhoneError.className = 'text-red-600 text-sm mt-1 hidden';
    emailPhoneGroup.appendChild(emailPhoneError);

    // Password
    const passwordGroup = document.createElement('div');
    const passwordLabel = document.createElement('label');
    passwordLabel.textContent = 'Password';
    passwordLabel.className = 'block mb-1 font-semibold';
    const passwordInput = document.createElement('input');
    passwordInput.type = 'password';
    passwordInput.placeholder = 'Masukkan password';
    passwordInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    passwordInput.required = true;
    passwordGroup.appendChild(passwordLabel);
    passwordGroup.appendChild(passwordInput);
    const passwordError = document.createElement('p');
    passwordError.className = 'text-red-600 text-sm mt-1 hidden';
    passwordGroup.appendChild(passwordError);

    // Konfirmasi password
    const confirmGroup = document.createElement('div');
    const confirmLabel = document.createElement('label');
    confirmLabel.textContent = 'Konfirmasi Password';
    confirmLabel.className = 'block mb-1 font-semibold';
    const confirmInput = document.createElement('input');
    confirmInput.type = 'password';
    confirmInput.placeholder = 'Masukkan ulang password';
    confirmInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    confirmInput.required = true;
    confirmGroup.appendChild(confirmLabel);
    confirmGroup.appendChild(confirmInput);
    const confirmError = document.createElement('p');
    confirmError.className = 'text-red-600 text-sm mt-1 hidden';
    confirmGroup.appendChild(confirmError);

    // Jenis pengguna
    const roleGroup = document.createElement('div');
    const roleLabel = document.createElement('label');
    roleLabel.textContent = 'Jenis Pengguna';
    roleLabel.className = 'block mb-1 font-semibold';
    const roleSelect = document.createElement('select');
    roleSelect.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    roleSelect.required = true;
    ['Klien', 'Lawyer', 'Notaris'].forEach(role => {
      const option = document.createElement('option');
      option.value = role.toLowerCase();
      option.textContent = role;
      roleSelect.appendChild(option);
    });
    roleGroup.appendChild(roleLabel);
    roleGroup.appendChild(roleSelect);

    // Checkbox syarat & ketentuan
    const termsGroup = document.createElement('div');
    termsGroup.className = 'flex items-center space-x-2';
    const termsCheckbox = document.createElement('input');
    termsCheckbox.type = 'checkbox';
    termsCheckbox.id = 'termsCheckbox';
    termsCheckbox.required = true;
    const termsLabel = document.createElement('label');
    termsLabel.htmlFor = 'termsCheckbox';
    termsLabel.className = 'text-sm';
    termsLabel.innerHTML = 'Saya setuju dengan <a href="#" class="text-[#3F51B5] hover:underline">Syarat & Ketentuan</a>';
    termsGroup.appendChild(termsCheckbox);
    termsGroup.appendChild(termsLabel);
    const termsError = document.createElement('p');
    termsError.className = 'text-red-600 text-sm mt-1 hidden';

    // Submit button
    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Daftar';
    submitBtn.className = 'w-full bg-[#3F51B5] text-white font-semibold py-2 rounded hover:bg-[#334296] transition flex justify-center items-center';
    // Loading spinner inside button
    const spinner = document.createElement('span');
    spinner.className = 'hidden spinner-border spinner-border-sm animate-spin ml-2 border-2 border-white border-t-transparent rounded-full w-5 h-5';
    submitBtn.appendChild(spinner);

    // Link to login
    const loginLink = document.createElement('p');
    loginLink.className = 'text-center mt-4 text-sm';
    loginLink.innerHTML = 'Sudah punya akun? <a href="#" class="text-[#3F51B5] hover:underline cursor-pointer">Masuk</a>';
    loginLink.querySelector('a').addEventListener('click', (e) => {
      e.preventDefault();
      navigateTo('login');
    });

    form.appendChild(nameGroup);
    form.appendChild(emailPhoneGroup);
    form.appendChild(passwordGroup);
    form.appendChild(confirmGroup);
    form.appendChild(roleGroup);
    form.appendChild(termsGroup);
    form.appendChild(termsError);
    form.appendChild(submitBtn);
    container.appendChild(title);
    container.appendChild(form);
    container.appendChild(loginLink);

    // Validation & submit handler
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      nameError.classList.add('hidden');
      emailPhoneError.classList.add('hidden');
      passwordError.classList.add('hidden');
      confirmError.classList.add('hidden');
      termsError.classList.add('hidden');

      const nameVal = nameInput.value.trim();
      const emailPhoneVal = emailPhoneInput.value.trim();
      const passwordVal = passwordInput.value;
      const confirmVal = confirmInput.value;
      const roleVal = roleSelect.value;
      const termsChecked = termsCheckbox.checked;

      if (!nameVal) {
        nameError.textContent = 'Nama lengkap wajib diisi.';
        nameError.classList.remove('hidden');
        return;
      }
      if (!isEmailOrPhone(emailPhoneVal)) {
        emailPhoneError.textContent = 'Masukkan email atau nomor telepon yang valid.';
        emailPhoneError.classList.remove('hidden');
        return;
      }
      if (!validatePassword(passwordVal)) {
        passwordError.textContent = 'Password minimal 8 karakter, mengandung huruf besar, kecil, dan angka.';
        passwordError.classList.remove('hidden');
        return;
      }
      if (passwordVal !== confirmVal) {
        confirmError.textContent = 'Password konfirmasi tidak cocok.';
        confirmError.classList.remove('hidden');
        return;
      }
      if (!termsChecked) {
        termsError.textContent = 'Anda harus menyetujui syarat & ketentuan.';
        termsError.classList.remove('hidden');
        return;
      }

      // Check if email/phone already registered
      const exists = appState.users.some(u => u.email === emailPhoneVal || u.phone === emailPhoneVal);
      if (exists) {
        emailPhoneError.textContent = 'Email atau nomor telepon sudah terdaftar.';
        emailPhoneError.classList.remove('hidden');
        return;
      }

      // Show loading
      submitBtn.disabled = true;
      spinner.classList.remove('hidden');

      // Simulate async register
      setTimeout(() => {
        const newUser = {
          id: generateId('user_'),
          name: nameVal,
          email: validateEmail(emailPhoneVal) ? emailPhoneVal : null,
          phone: validatePhone(emailPhoneVal) ? emailPhoneVal : null,
          password: passwordVal,
          role: roleVal,
        };
        appState.users.push(newUser);
        saveUsers();
        saveSession(newUser);
        appState.currentMainTab = null;
        navigateTo('main');
      }, 1200);
    });

    return container;
  }

  // 4. Main page based on role
  function renderMain() {
    const user = getCurrentUser();
    if (!user) {
      navigateTo('login');
      return document.createElement('div');
    }

    const container = document.createElement('div');
    container.className = 'flex flex-col min-h-screen bg-white';

    // Header
    const header = document.createElement('header');
    header.className = 'flex items-center justify-between bg-[#3F51B5] text-white p-4 shadow';

    const welcomeText = document.createElement('h1');
    welcomeText.textContent = `Selamat Datang, ${user.name}!`;
    welcomeText.className = 'text-lg font-semibold';

    // Notification button
    const notifBtn = document.createElement('button');
    notifBtn.className = 'relative mr-4 focus:outline-none';
    notifBtn.title = 'Notifikasi';
    notifBtn.innerHTML = '<i class="fas fa-bell fa-lg"></i>';
    notifBtn.addEventListener('click', () => {
      alert('Fitur notifikasi belum tersedia.');
    });

    // Logout button
    const logoutBtn = document.createElement('button');
    logoutBtn.className = 'focus:outline-none hover:text-[#FFD700] transition';
    logoutBtn.title = 'Logout';
    logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt fa-lg"></i>';
    logoutBtn.addEventListener('click', () => {
      if (confirm('Apakah Anda yakin ingin logout?')) {
        logoutUser();
      }
    });

    header.appendChild(welcomeText);
    const rightGroup = document.createElement('div');
    rightGroup.className = 'flex items-center';
    rightGroup.appendChild(notifBtn);
    rightGroup.appendChild(logoutBtn);
    header.appendChild(rightGroup);

    container.appendChild(header);

    // Content container
    const content = document.createElement('main');
    content.className = 'flex-grow overflow-auto p-4';

    // Role-based content
    if (user.role === 'klien') {
      content.appendChild(renderMainKlien(user));
    } else if (user.role === 'lawyer') {
      content.appendChild(renderMainLawyer(user));
    } else if (user.role === 'notaris') {
      content.appendChild(renderMainNotaris(user));
    }

    container.appendChild(content);

    // Bottom navigation bar
    container.appendChild(renderBottomNav(user.role));

    return container;
  }

  // Main Klien content
  function renderMainKlien(user) {
    const container = document.createElement('div');
    container.className = 'space-y-8';

    // Ringkasan layanan
    const summary = document.createElement('section');
    summary.className = 'bg-[#3F51B5] text-white rounded p-4 shadow';
    summary.textContent = 'LawLink menyediakan solusi hukum digital terpercaya untuk kebutuhan Anda. Konsultasi, jasa notaris, dan dokumen legal kini lebih mudah dan cepat.';

    container.appendChild(summary);

    // Dashboard menu cards/buttons
    const dashboard = document.createElement('section');
    dashboard.className = 'grid grid-cols-2 gap-4';

    const menuItems = [
      { id: 'konsultasi', label: 'Konsultasi Hukum', icon: 'fas fa-comments', action: () => navigateTo('consultation', { tab: 'booking' }) },
      { id: 'notaris', label: 'Jasa Notaris', icon: 'fas fa-file-signature', action: () => navigateTo('notaris', { tab: 'list' }) },
      { id: 'dokumen', label: 'Dokumen Legal', icon: 'fas fa-file-alt', action: () => navigateTo('documents', { tab: 'gallery' }) },
      { id: 'riwayat', label: 'Riwayat Konsultasi', icon: 'fas fa-history', action: () => navigateTo('history') },
      { id: 'profil', label: 'Profil', icon: 'fas fa-user', action: () => navigateTo('profile') },
    ];

    menuItems.forEach(item => {
      const card = document.createElement('button');
      card.className = 'flex flex-col items-center justify-center bg-white rounded shadow p-4 hover:shadow-lg transition focus:outline-none';
      card.setAttribute('aria-label', item.label);
      card.addEventListener('click', item.action);

      const icon = document.createElement('i');
      icon.className = `${item.icon} text-[#3F51B5] text-4xl mb-2`;
      card.appendChild(icon);

      const label = document.createElement('span');
      label.textContent = item.label;
      label.className = 'text-[#3F51B5] font-semibold text-center';
      card.appendChild(label);

      dashboard.appendChild(card);
    });

    container.appendChild(dashboard);

    // Section Pintasan Layanan
    const pintasan = document.createElement('section');
    pintasan.className = 'mt-8';

    const pintasanTitle = document.createElement('h2');
    pintasanTitle.textContent = 'Pintasan Layanan';
    pintasanTitle.className = 'text-xl font-semibold text-[#3F51B5] mb-4';
    pintasan.appendChild(pintasanTitle);

    const pintasanGrid = document.createElement('div');
    pintasanGrid.className = 'grid grid-cols-1 sm:grid-cols-2 gap-6';

    const pintasanItems = [
      {
        id: 'konsultasi',
        title: 'Konsultasi Hukum',
        desc: 'Hubungi lawyer profesional untuk konsultasi online/offline.',
        icon: 'fas fa-comments',
        action: () => navigateTo('consultation', { tab: 'booking' }),
      },
      {
        id: 'notaris',
        title: 'Jasa Notaris',
        desc: 'Pengurusan akta, legalisasi dokumen, dan PPAT oleh notaris terpercaya.',
        icon: 'fas fa-file-signature',
        action: () => navigateTo('notaris', { tab: 'list' }),
      },
      {
        id: 'dokumen',
        title: 'Dokumen Legal',
        desc: 'Akses template dokumen hukum dan pengurusan surat secara profesional.',
        icon: 'fas fa-file-alt',
        action: () => navigateTo('documents', { tab: 'gallery' }),
      },
      {
        id: 'riwayat',
        title: 'Riwayat Konsultasi',
        desc: 'Lihat semua riwayat konsultasi Anda dengan lawyer.',
        icon: 'fas fa-history',
        action: () => navigateTo('history'),
      },
    ];

    pintasanItems.forEach(item => {
      const card = document.createElement('button');
      card.className = 'flex items-center space-x-4 bg-white rounded shadow p-4 hover:shadow-lg transition focus:outline-none';
      card.addEventListener('click', item.action);

      const iconWrapper = document.createElement('div');
      iconWrapper.className = 'text-[#3F51B5] text-3xl flex-shrink-0';
      const icon = document.createElement('i');
      icon.className = item.icon;
      iconWrapper.appendChild(icon);

      const textWrapper = document.createElement('div');
      const title = document.createElement('h3');
      title.textContent = item.title;
      title.className = 'font-semibold text-[#3F51B5]';
      const desc = document.createElement('p');
      desc.textContent = item.desc;
      desc.className = 'text-gray-600 text-sm';

      textWrapper.appendChild(title);
      textWrapper.appendChild(desc);

      card.appendChild(iconWrapper);
      card.appendChild(textWrapper);

      pintasanGrid.appendChild(card);
    });

    pintasan.appendChild(pintasanGrid);
    container.appendChild(pintasan);

    // Section Pilihan Lawyer & Notaris
    const pilihanSection = document.createElement('section');
    pilihanSection.className = 'mt-8';

    const pilihanTitle = document.createElement('h2');
    pilihanTitle.textContent = 'Pilihan Lawyer & Notaris';
    pilihanTitle.className = 'text-xl font-semibold text-[#3F51B5] mb-4';
    pilihanSection.appendChild(pilihanTitle);

    const pilihanGrid = document.createElement('div');
    pilihanGrid.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6';

    // Combine lawyers and notaris for display
    const combined = [...appState.lawyers, ...appState.notaris];

    combined.forEach(person => {
      const card = document.createElement('div');
      card.className = 'bg-white rounded shadow p-4 flex flex-col items-center text-center';

      const img = document.createElement('img');
      img.src = person.photo;
      img.alt = `Foto profil ${person.name}, seorang profesional hukum/notaris`;
      img.className = 'w-24 h-24 rounded-full object-cover mb-3';

      const name = document.createElement('h3');
      name.textContent = person.name;
      name.className = 'font-semibold text-[#3F51B5] mb-1';

      const spec = document.createElement('p');
      spec.textContent = person.specialization;
      spec.className = 'text-gray-600 mb-3';

      const btn = document.createElement('button');
      btn.textContent = 'Lihat Profil';
      btn.className = 'bg-[#FFD700] text-[#3F51B5] font-semibold px-4 py-2 rounded hover:bg-[#e6c200] transition focus:outline-none';
      btn.addEventListener('click', () => {
        alert(`Profil ${person.name} belum tersedia.`);
      });

      card.appendChild(img);
      card.appendChild(name);
      card.appendChild(spec);
      card.appendChild(btn);

      pilihanGrid.appendChild(card);
    });

    pilihanSection.appendChild(pilihanGrid);
    container.appendChild(pilihanSection);

    // Section Artikel Terbaru/Blog Hukum
    const blogSection = document.createElement('section');
    blogSection.className = 'mt-8';

    const blogTitle = document.createElement('h2');
    blogTitle.textContent = 'Artikel Terbaru / Blog Hukum';
    blogTitle.className = 'text-xl font-semibold text-[#3F51B5] mb-4';
    blogSection.appendChild(blogTitle);

    const blogGrid = document.createElement('div');
    blogGrid.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6';

    appState.blogs.forEach(blog => {
      const card = document.createElement('div');
      card.className = 'bg-white rounded shadow overflow-hidden flex flex-col';

      const img = document.createElement('img');
      img.src = blog.thumbnail;
      img.alt = `Thumbnail artikel berjudul ${blog.title}`;
      img.className = 'w-full h-40 object-cover';

      const content = document.createElement('div');
      content.className = 'p-4 flex flex-col flex-grow';

      const title = document.createElement('h3');
      title.textContent = blog.title;
      title.className = 'font-semibold text-[#3F51B5] mb-2';

      const preview = document.createElement('p');
      preview.textContent = blog.preview;
      preview.className = 'text-gray-600 flex-grow';

      const btn = document.createElement('button');
      btn.textContent = 'Baca Selengkapnya';
      btn.className = 'mt-4 self-start bg-[#FFD700] text-[#3F51B5] font-semibold px-4 py-2 rounded hover:bg-[#e6c200] transition focus:outline-none';
      btn.addEventListener('click', () => {
        alert(`Artikel: ${blog.title}\n\n${blog.content}`);
      });

      content.appendChild(title);
      content.appendChild(preview);
      content.appendChild(btn);

      card.appendChild(img);
      card.appendChild(content);

      blogGrid.appendChild(card);
    });

    blogSection.appendChild(blogGrid);
    container.appendChild(blogSection);

    return container;
  }

  // Main Lawyer content
  function renderMainLawyer(user) {
    const container = document.createElement('div');
    container.className = 'space-y-8';

    // Dashboard menu cards/buttons
    const dashboard = document.createElement('section');
    dashboard.className = 'grid grid-cols-2 gap-4';

    const menuItems = [
      { id: 'jadwal', label: 'Jadwal Konsultasi', icon: 'fas fa-calendar-alt', action: () => navigateTo('consultation', { tab: 'schedule' }) },
      { id: 'kasus', label: 'Kasus Berjalan', icon: 'fas fa-briefcase', action: () => alert('Fitur Kasus Berjalan belum tersedia.') },
      { id: 'dokumen', label: 'Dokumen Klien', icon: 'fas fa-file-alt', action: () => navigateTo('documents', { tab: 'mydocs' }) },
      { id: 'profil', label: 'Profil', icon: 'fas fa-user', action: () => navigateTo('profile') },
      { id: 'notifikasi', label: 'Notifikasi', icon: 'fas fa-bell', action: () => alert('Fitur Notifikasi belum tersedia.') },
    ];

    menuItems.forEach(item => {
      const card = document.createElement('button');
      card.className = 'flex flex-col items-center justify-center bg-white rounded shadow p-4 hover:shadow-lg transition focus:outline-none';
      card.setAttribute('aria-label', item.label);
      card.addEventListener('click', item.action);

      const icon = document.createElement('i');
      icon.className = `${item.icon} text-[#3F51B5] text-4xl mb-2`;
      card.appendChild(icon);

      const label = document.createElement('span');
      label.textContent = item.label;
      label.className = 'text-[#3F51B5] font-semibold text-center';
      card.appendChild(label);

      dashboard.appendChild(card);
    });

    container.appendChild(dashboard);

    return container;
  }

  // Main Notaris content
  function renderMainNotaris(user) {
    const container = document.createElement('div');
    container.className = 'space-y-8';

    // Dashboard menu cards/buttons
    const dashboard = document.createElement('section');
    dashboard.className = 'grid grid-cols-2 gap-4';

    const menuItems = [
      { id: 'jadwal', label: 'Jadwal Notaris', icon: 'fas fa-calendar-alt', action: () => alert('Fitur Jadwal Notaris belum tersedia.') },
      { id: 'akta', label: 'Akta yang Diproses', icon: 'fas fa-file-signature', action: () => alert('Fitur Akta yang Diproses belum tersedia.') },
      { id: 'dokumen', label: 'Dokumen Klien', icon: 'fas fa-file-alt', action: () => navigateTo('documents', { tab: 'mydocs' }) },
      { id: 'biaya', label: 'Biaya & Tarif', icon: 'fas fa-money-bill-wave', action: () => alert('Fitur Biaya & Tarif belum tersedia.') },
      { id: 'profil', label: 'Profil', icon: 'fas fa-user', action: () => navigateTo('profile') },
    ];

    menuItems.forEach(item => {
      const card = document.createElement('button');
      card.className = 'flex flex-col items-center justify-center bg-white rounded shadow p-4 hover:shadow-lg transition focus:outline-none';
      card.setAttribute('aria-label', item.label);
      card.addEventListener('click', item.action);

      const icon = document.createElement('i');
      icon.className = `${item.icon} text-[#3F51B5] text-4xl mb-2`;
      card.appendChild(icon);

      const label = document.createElement('span');
      label.textContent = item.label;
      label.className = 'text-[#3F51B5] font-semibold text-center';
      card.appendChild(label);

      dashboard.appendChild(card);
    });

    container.appendChild(dashboard);

    return container;
  }

  // Bottom navigation bar
  function renderBottomNav(role) {
    const nav = document.createElement('nav');
    nav.className = 'fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around items-center h-16 shadow';

    let tabs = [];

    if (role === 'klien') {
      tabs = [
        { id: 'home', label: 'Beranda', icon: 'fas fa-home', action: () => navigateTo('main') },
        { id: 'konsultasi', label: 'Konsultasi', icon: 'fas fa-comments', action: () => navigateTo('consultation', { tab: 'booking' }) },
        { id: 'notaris', label: 'Notaris', icon: 'fas fa-file-signature', action: () => navigateTo('notaris', { tab: 'list' }) },
        { id: 'dokumen', label: 'Dokumen', icon: 'fas fa-file-alt', action: () => navigateTo('documents', { tab: 'gallery' }) },
        { id: 'profil', label: 'Profil', icon: 'fas fa-user', action: () => navigateTo('profile') },
      ];
    } else if (role === 'lawyer') {
      tabs = [
        { id: 'jadwal', label: 'Jadwal', icon: 'fas fa-calendar-alt', action: () => navigateTo('consultation', { tab: 'schedule' }) },
        { id: 'kasus', label: 'Kasus', icon: 'fas fa-briefcase', action: () => alert('Fitur Kasus Berjalan belum tersedia.') },
        { id: 'dokumen', label: 'Dokumen', icon: 'fas fa-file-alt', action: () => navigateTo('documents', { tab: 'mydocs' }) },
        { id: 'profil', label: 'Profil', icon: 'fas fa-user', action: () => navigateTo('profile') },
        { id: 'notifikasi', label: 'Notifikasi', icon: 'fas fa-bell', action: () => alert('Fitur Notifikasi belum tersedia.') },
      ];
    } else if (role === 'notaris') {
      tabs = [
        { id: 'jadwal', label: 'Jadwal', icon: 'fas fa-calendar-alt', action: () => alert('Fitur Jadwal Notaris belum tersedia.') },
        { id: 'akta', label: 'Akta', icon: 'fas fa-file-signature', action: () => alert('Fitur Akta yang Diproses belum tersedia.') },
        { id: 'dokumen', label: 'Dokumen', icon: 'fas fa-file-alt', action: () => navigateTo('documents', { tab: 'mydocs' }) },
        { id: 'biaya', label: 'Biaya', icon: 'fas fa-money-bill-wave', action: () => alert('Fitur Biaya & Tarif belum tersedia.') },
        { id: 'profil', label: 'Profil', icon: 'fas fa-user', action: () => navigateTo('profile') },
      ];
    }

    tabs.forEach(tab => {
      const btn = document.createElement('button');
      btn.className = 'flex flex-col items-center justify-center text-gray-600 hover:text-[#3F51B5] focus:outline-none';
      btn.title = tab.label;
      btn.addEventListener('click', tab.action);

      const icon = document.createElement('i');
      icon.className = `${tab.icon} text-xl mb-1`;
      btn.appendChild(icon);

      const label = document.createElement('span');
      label.textContent = tab.label;
      label.className = 'text-xs';
      btn.appendChild(label);

      nav.appendChild(btn);
    });

    return nav;
  }

  // Consultation page (for Klien and Lawyer)
  function renderConsultation() {
    const user = getCurrentUser();
    if (!user) {
      navigateTo('login');
      return document.createElement('div');
    }

    const container = document.createElement('div');
    container.className = 'flex flex-col min-h-screen bg-white';

    // Header
    const header = document.createElement('header');
    header.className = 'flex items-center justify-between bg-[#3F51B5] text-white p-4 shadow';

    const title = document.createElement('h1');
    title.textContent = 'Konsultasi Hukum';
    title.className = 'text-lg font-semibold';

    const backBtn = document.createElement('button');
    backBtn.className = 'focus:outline-none hover:text-[#FFD700] transition';
    backBtn.title = 'Kembali';
    backBtn.innerHTML = '<i class="fas fa-arrow-left fa-lg"></i>';
    backBtn.addEventListener('click', () => {
      navigateTo('main');
    });

    header.appendChild(backBtn);
    header.appendChild(title);
    header.appendChild(document.createElement('div')); // spacer

    container.appendChild(header);

    // Tabs for consultation
    const tabsContainer = document.createElement('div');
    tabsContainer.className = 'flex border-b border-gray-200';

    const tabs = [
      { id: 'booking', label: 'Booking Konsultasi' },
      { id: 'schedule', label: 'Jadwal Konsultasi' },
      { id: 'chat', label: 'Chat' },
    ];

    tabs.forEach(tab => {
      const tabBtn = document.createElement('button');
      tabBtn.textContent = tab.label;
      tabBtn.className = `flex-grow py-3 text-center font-semibold ${
        appState.currentConsultationTab === tab.id ? 'border-b-4 border-[#3F51B5] text-[#3F51B5]' : 'text-gray-600'
      } focus:outline-none`;
      tabBtn.addEventListener('click', () => {
        appState.currentConsultationTab = tab.id;
        renderApp();
      });
      tabsContainer.appendChild(tabBtn);
    });

    container.appendChild(tabsContainer);

    // Content area
    const content = document.createElement('div');
    content.className = 'p-4 flex-grow overflow-auto';

    if (appState.currentConsultationTab === 'booking') {
      content.appendChild(renderConsultationBooking(user));
    } else if (appState.currentConsultationTab === 'schedule') {
      content.appendChild(renderConsultationSchedule(user));
    } else if (appState.currentConsultationTab === 'chat') {
      content.appendChild(renderConsultationChat(user));
    }

    container.appendChild(content);

    return container;
  }

  // Consultation Booking form (Klien only)
  function renderConsultationBooking(user) {
    if (user.role !== 'klien') {
      const div = document.createElement('div');
      div.textContent = 'Fitur booking konsultasi hanya untuk Klien.';
      div.className = 'text-center text-gray-600 mt-6';
      return div;
    }

    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto space-y-6';

    // Form
    const form = document.createElement('form');
    form.className = 'space-y-5';

    // Tanggal
    const dateGroup = document.createElement('div');
    const dateLabel = document.createElement('label');
    dateLabel.textContent = 'Pilih Tanggal';
    dateLabel.className = 'block mb-1 font-semibold';
    const dateInput = document.createElement('input');
    dateInput.type = 'date';
    dateInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    dateInput.required = true;
    dateGroup.appendChild(dateLabel);
    dateGroup.appendChild(dateInput);

    // Waktu
    const timeGroup = document.createElement('div');
    const timeLabel = document.createElement('label');
    timeLabel.textContent = 'Pilih Waktu';
    timeLabel.className = 'block mb-1 font-semibold';
    const timeInput = document.createElement('input');
    timeInput.type = 'time';
    timeInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    timeInput.required = true;
    timeGroup.appendChild(timeLabel);
    timeGroup.appendChild(timeInput);

    // Jenis kasus
    const caseGroup = document.createElement('div');
    const caseLabel = document.createElement('label');
    caseLabel.textContent = 'Jenis Kasus';
    caseLabel.className = 'block mb-1 font-semibold';
    const caseSelect = document.createElement('select');
    caseSelect.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    caseSelect.required = true;
    ['Hukum Perdata', 'Hukum Pidana', 'Hukum Bisnis', 'Hukum Keluarga', 'Lainnya'].forEach(jenis => {
      const option = document.createElement('option');
      option.value = jenis;
      option.textContent = jenis;
      caseSelect.appendChild(option);
    });
    caseGroup.appendChild(caseLabel);
    caseGroup.appendChild(caseSelect);

    // Deskripsi masalah
    const descGroup = document.createElement('div');
    const descLabel = document.createElement('label');
    descLabel.textContent = 'Deskripsi Masalah';
    descLabel.className = 'block mb-1 font-semibold';
    const descTextarea = document.createElement('textarea');
    descTextarea.rows = 4;
    descTextarea.placeholder = 'Jelaskan masalah hukum Anda secara singkat';
    descTextarea.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5] resize-none';
    descTextarea.required = true;
    descGroup.appendChild(descLabel);
    descGroup.appendChild(descTextarea);

    // Submit button
    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Booking Sekarang';
    submitBtn.className = 'w-full bg-[#3F51B5] text-white font-semibold py-2 rounded hover:bg-[#334296] transition flex justify-center items-center';
    const spinner = document.createElement('span');
    spinner.className = 'hidden spinner-border spinner-border-sm animate-spin ml-2 border-2 border-white border-t-transparent rounded-full w-5 h-5';
    submitBtn.appendChild(spinner);

    form.appendChild(dateGroup);
    form.appendChild(timeGroup);
    form.appendChild(caseGroup);
    form.appendChild(descGroup);
    form.appendChild(submitBtn);

    // Validation & submit handler
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      if (!dateInput.value) {
        alert('Tanggal wajib dipilih.');
        return;
      }
      if (!timeInput.value) {
        alert('Waktu wajib dipilih.');
        return;
      }
      if (!caseSelect.value) {
        alert('Jenis kasus wajib dipilih.');
        return;
      }
      if (!descTextarea.value.trim()) {
        alert('Deskripsi masalah wajib diisi.');
        return;
      }

      submitBtn.disabled = true;
      spinner.classList.remove('hidden');

      setTimeout(() => {
        const appointment = {
          id: generateId('appt_'),
          userId: user.id,
          date: dateInput.value,
          time: timeInput.value,
          caseType: caseSelect.value,
          description: descTextarea.value.trim(),
          status: 'pending',
        };
        appState.appointments.push(appointment);
        saveAppointments();
        alert('Booking konsultasi berhasil! Kami akan menghubungi Anda.');
        form.reset();
        submitBtn.disabled = false;
        spinner.classList.add('hidden');
      }, 1200);
    });

    container.appendChild(form);

    return container;
  }

  // Consultation Schedule (for Klien and Lawyer)
  function renderConsultationSchedule(user) {
    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto';

    const title = document.createElement('h2');
    title.textContent = 'Jadwal Konsultasi Anda';
    title.className = 'text-lg font-semibold text-[#3F51B5] mb-4 text-center';
    container.appendChild(title);

    // Filter appointments by user
    let filteredAppointments = [];
    if (user.role === 'klien') {
      filteredAppointments = appState.appointments.filter(a => a.userId === user.id);
    } else if (user.role === 'lawyer') {
      // For simplicity, show all appointments (in real app, filter by lawyer)
      filteredAppointments = appState.appointments;
    }

    if (filteredAppointments.length === 0) {
      const emptyMsg = document.createElement('p');
      emptyMsg.textContent = 'Belum ada jadwal konsultasi.';
      emptyMsg.className = 'text-center text-gray-600 mt-6';
      container.appendChild(emptyMsg);
      return container;
    }

    const list = document.createElement('ul');
    list.className = 'space-y-4';

    filteredAppointments.forEach(appt => {
      const item = document.createElement('li');
      item.className = 'bg-white rounded shadow p-4 flex flex-col';

      const dateTime = document.createElement('p');
      dateTime.textContent = `Tanggal: ${appt.date}, Waktu: ${appt.time}`;
      dateTime.className = 'font-semibold text-[#3F51B5] mb-1';

      const caseType = document.createElement('p');
      caseType.textContent = `Jenis Kasus: ${appt.caseType}`;
      caseType.className = 'mb-1';

      const desc = document.createElement('p');
      desc.textContent = `Deskripsi: ${appt.description}`;
      desc.className = 'mb-1';

      const status = document.createElement('p');
      status.textContent = `Status: ${appt.status}`;
      status.className = 'font-semibold';

      item.appendChild(dateTime);
      item.appendChild(caseType);
      item.appendChild(desc);
      item.appendChild(status);

      list.appendChild(item);
    });

    container.appendChild(list);

    return container;
  }

  // Consultation Chat interface (for Klien and Lawyer)
  function renderConsultationChat(user) {
    const container = document.createElement('div');
    container.className = 'flex flex-col max-w-lg mx-auto h-[70vh] border border-gray-300 rounded';

    // Select chat partner (for Klien: lawyers, for Lawyer: clients)
    const chatPartnerSelect = document.createElement('select');
    chatPartnerSelect.className = 'border-b border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    chatPartnerSelect.setAttribute('aria-label', 'Pilih lawan chat');

    let options = [];
    if (user.role === 'klien') {
      options = appState.lawyers;
    } else if (user.role === 'lawyer') {
      // Show clients who have appointments with this lawyer (simplified: all clients)
      options = appState.users.filter(u => u.role === 'klien');
    }

    if (options.length === 0) {
      const noPartner = document.createElement('p');
      noPartner.textContent = 'Belum ada lawan chat tersedia.';
      noPartner.className = 'p-4 text-center text-gray-600';
      return noPartner;
    }

    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = '-- Pilih lawan chat --';
    chatPartnerSelect.appendChild(defaultOption);

    options.forEach(opt => {
      const option = document.createElement('option');
      option.value = opt.id;
      option.textContent = opt.name;
      chatPartnerSelect.appendChild(option);
    });

    container.appendChild(chatPartnerSelect);

    // Chat messages container
    const messagesContainer = document.createElement('div');
    messagesContainer.className = 'flex-grow overflow-auto p-4 space-y-3 chat-scroll bg-gray-50';

    container.appendChild(messagesContainer);

    // Input area
    const inputArea = document.createElement('form');
    inputArea.className = 'flex border-t border-gray-300 p-2 bg-white';

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'Ketik pesan...';
    input.className = 'flex-grow border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    input.required = true;

    const sendBtn = document.createElement('button');
    sendBtn.type = 'submit';
    sendBtn.className = 'ml-2 bg-[#3F51B5] text-white px-4 py-2 rounded hover:bg-[#334296] transition flex items-center';
    sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';

    inputArea.appendChild(input);
    inputArea.appendChild(sendBtn);

    container.appendChild(inputArea);

    // Current chat partner id
    let currentChatPartnerId = null;

    // Load chat messages
    function loadMessages(partnerId) {
      messagesContainer.innerHTML = '';
      if (!partnerId) return;
      const chats = getChatHistory(user.id, partnerId);
      chats.forEach(chat => {
        const msgDiv = document.createElement('div');
        msgDiv.className = `max-w-xs px-3 py-2 rounded ${
          chat.from === user.id ? 'bg-[#3F51B5] text-white self-end' : 'bg-gray-300 text-gray-800 self-start'
        }`;
        msgDiv.textContent = chat.message;
        messagesContainer.appendChild(msgDiv);
      });
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    chatPartnerSelect.addEventListener('change', () => {
      currentChatPartnerId = chatPartnerSelect.value || null;
      loadMessages(currentChatPartnerId);
    });

    inputArea.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!currentChatPartnerId) {
        alert('Pilih lawan chat terlebih dahulu.');
        return;
      }
      const msg = input.value.trim();
      if (!msg) return;
      saveChatMessage(user.id, currentChatPartnerId, msg);
      input.value = '';
      loadMessages(currentChatPartnerId);
    });

    return container;
  }

  // Notaris page
  function renderNotaris() {
    const user = getCurrentUser();
    if (!user) {
      navigateTo('login');
      return document.createElement('div');
    }

    const container = document.createElement('div');
    container.className = 'flex flex-col min-h-screen bg-white';

    // Header
    const header = document.createElement('header');
    header.className = 'flex items-center justify-between bg-[#3F51B5] text-white p-4 shadow';

    const title = document.createElement('h1');
    title.textContent = 'Jasa Notaris';
    title.className = 'text-lg font-semibold';

    const backBtn = document.createElement('button');
    backBtn.className = 'focus:outline-none hover:text-[#FFD700] transition';
    backBtn.title = 'Kembali';
    backBtn.innerHTML = '<i class="fas fa-arrow-left fa-lg"></i>';
    backBtn.addEventListener('click', () => {
      navigateTo('main');
    });

    header.appendChild(backBtn);
    header.appendChild(title);
    header.appendChild(document.createElement('div')); // spacer

    container.appendChild(header);

    // Tabs for notaris
    const tabsContainer = document.createElement('div');
    tabsContainer.className = 'flex border-b border-gray-200';

    const tabs = [
      { id: 'list', label: 'Layanan Notaris' },
      { id: 'form', label: 'Pengajuan Dokumen' },
      { id: 'tracking', label: 'Tracking Status' },
    ];

    tabs.forEach(tab => {
      const tabBtn = document.createElement('button');
      tabBtn.textContent = tab.label;
      tabBtn.className = `flex-grow py-3 text-center font-semibold ${
        appState.currentNotarisTab === tab.id ? 'border-b-4 border-[#3F51B5] text-[#3F51B5]' : 'text-gray-600'
      } focus:outline-none`;
      tabBtn.addEventListener('click', () => {
        appState.currentNotarisTab = tab.id;
        renderApp();
      });
      tabsContainer.appendChild(tabBtn);
    });

    container.appendChild(tabsContainer);

    // Content area
    const content = document.createElement('div');
    content.className = 'p-4 flex-grow overflow-auto';

    if (appState.currentNotarisTab === 'list') {
      content.appendChild(renderNotarisList());
    } else if (appState.currentNotarisTab === 'form') {
      content.appendChild(renderNotarisForm(user));
    } else if (appState.currentNotarisTab === 'tracking') {
      content.appendChild(renderNotarisTracking(user));
    }

    container.appendChild(content);

    return container;
  }

  // Notaris list layanan
  function renderNotarisList() {
    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto space-y-4';

    const layanan = [
      {
        id: 'akta',
        title: 'Pengurusan Akta',
        desc: 'Membantu pembuatan akta notaris sesuai kebutuhan Anda.',
      },
      {
        id: 'legalisasi',
        title: 'Legalisasi Dokumen',
        desc: 'Proses legalisasi dokumen resmi dengan cepat dan terpercaya.',
      },
      {
        id: 'ppat',
        title: 'PPAT',
        desc: 'Pelayanan Pejabat Pembuat Akta Tanah untuk transaksi properti.',
      },
    ];

    layanan.forEach(item => {
      const card = document.createElement('div');
      card.className = 'bg-white rounded shadow p-4';

      const title = document.createElement('h3');
      title.textContent = item.title;
      title.className = 'font-semibold text-[#3F51B5] mb-2';

      const desc = document.createElement('p');
      desc.textContent = item.desc;
      desc.className = 'text-gray-600';

      card.appendChild(title);
      card.appendChild(desc);

      container.appendChild(card);
    });

    return container;
  }

  // Notaris form pengajuan dokumen
  function renderNotarisForm(user) {
    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto';

    const form = document.createElement('form');
    form.className = 'space-y-5';

    // Upload file
    const fileGroup = document.createElement('div');
    const fileLabel = document.createElement('label');
    fileLabel.textContent = 'Upload File Dokumen';
    fileLabel.className = 'block mb-1 font-semibold';
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.pdf,.doc,.docx,.jpg,.png';
    fileInput.className = 'w-full';
    fileInput.required = true;
    fileGroup.appendChild(fileLabel);
    fileGroup.appendChild(fileInput);

    // Input data dokumen
    const dataGroup = document.createElement('div');
    const dataLabel = document.createElement('label');
    dataLabel.textContent = 'Data Dokumen';
    dataLabel.className = 'block mb-1 font-semibold';
    const dataInput = document.createElement('textarea');
    dataInput.rows = 4;
    dataInput.placeholder = 'Masukkan detail data dokumen';
    dataInput.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5] resize-none';
    dataInput.required = true;
    dataGroup.appendChild(dataLabel);
    dataGroup.appendChild(dataInput);

    // Pilih jenis akta
    const aktaGroup = document.createElement('div');
    const aktaLabel = document.createElement('label');
    aktaLabel.textContent = 'Pilih Jenis Akta';
    aktaLabel.className = 'block mb-1 font-semibold';
    const aktaSelect = document.createElement('select');
    aktaSelect.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    aktaSelect.required = true;
    ['Akta Jual Beli', 'Akta Pendirian PT', 'Akta Wasiat', 'Akta Perjanjian', 'Lainnya'].forEach(jenis => {
      const option = document.createElement('option');
      option.value = jenis;
      option.textContent = jenis;
      aktaSelect.appendChild(option);
    });
    aktaGroup.appendChild(aktaLabel);
    aktaGroup.appendChild(aktaSelect);

    // Submit button
    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Ajukan';
    submitBtn.className = 'w-full bg-[#3F51B5] text-white font-semibold py-2 rounded hover:bg-[#334296] transition flex justify-center items-center';
    const spinner = document.createElement('span');
    spinner.className = 'hidden spinner-border spinner-border-sm animate-spin ml-2 border-2 border-white border-t-transparent rounded-full w-5 h-5';
    submitBtn.appendChild(spinner);

    form.appendChild(fileGroup);
    form.appendChild(dataGroup);
    form.appendChild(aktaGroup);
    form.appendChild(submitBtn);

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      if (!fileInput.files.length) {
        alert('File dokumen wajib diupload.');
        return;
      }
      if (!dataInput.value.trim()) {
        alert('Data dokumen wajib diisi.');
        return;
      }
      if (!aktaSelect.value) {
        alert('Jenis akta wajib dipilih.');
        return;
      }

      submitBtn.disabled = true;
      spinner.classList.remove('hidden');

      setTimeout(() => {
        const doc = {
          id: generateId('doc_'),
          userId: user.id,
          fileName: fileInput.files[0].name,
          data: dataInput.value.trim(),
          aktaType: aktaSelect.value,
          status: 'pending',
          uploadedAt: new Date().toISOString(),
        };
        appState.documents.push(doc);
        saveDocuments();
        alert('Pengajuan dokumen berhasil! Kami akan memprosesnya.');
        form.reset();
        submitBtn.disabled = false;
        spinner.classList.add('hidden');
      }, 1200);
    });

    container.appendChild(form);

    return container;
  }

  // Notaris tracking status dokumen
  function renderNotarisTracking(user) {
    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto';

    const title = document.createElement('h2');
    title.textContent = 'Tracking Status Dokumen';
    title.className = 'text-lg font-semibold text-[#3F51B5] mb-4 text-center';
    container.appendChild(title);

    // Filter documents by user
    const userDocs = appState.documents.filter(d => d.userId === user.id);

    if (userDocs.length === 0) {
      const emptyMsg = document.createElement('p');
      emptyMsg.textContent = 'Belum ada dokumen yang diajukan.';
      emptyMsg.className = 'text-center text-gray-600 mt-6';
      container.appendChild(emptyMsg);
      return container;
    }

    const list = document.createElement('ul');
    list.className = 'space-y-4';

    userDocs.forEach(doc => {
      const item = document.createElement('li');
      item.className = 'bg-white rounded shadow p-4 flex flex-col';

      const fileName = document.createElement('p');
      fileName.textContent = `File: ${doc.fileName}`;
      fileName.className = 'font-semibold text-[#3F51B5] mb-1';

      const aktaType = document.createElement('p');
      aktaType.textContent = `Jenis Akta: ${doc.aktaType}`;
      aktaType.className = 'mb-1';

      const status = document.createElement('p');
      status.textContent = `Status: ${doc.status}`;
      status.className = 'font-semibold';

      item.appendChild(fileName);
      item.appendChild(aktaType);
      item.appendChild(status);

      list.appendChild(item);
    });

    container.appendChild(list);

    return container;
  }

  // Documents page
  function renderDocuments() {
    const user = getCurrentUser();
    if (!user) {
      navigateTo('login');
      return document.createElement('div');
    }

    const container = document.createElement('div');
    container.className = 'flex flex-col min-h-screen bg-white';

    // Header
    const header = document.createElement('header');
    header.className = 'flex items-center justify-between bg-[#3F51B5] text-white p-4 shadow';

    const title = document.createElement('h1');
    title.textContent = 'Dokumen Legal';
    title.className = 'text-lg font-semibold';

    const backBtn = document.createElement('button');
    backBtn.className = 'focus:outline-none hover:text-[#FFD700] transition';
    backBtn.title = 'Kembali';
    backBtn.innerHTML = '<i class="fas fa-arrow-left fa-lg"></i>';
    backBtn.addEventListener('click', () => {
      navigateTo('main');
    });

    header.appendChild(backBtn);
    header.appendChild(title);
    header.appendChild(document.createElement('div')); // spacer

    container.appendChild(header);

    // Tabs for documents
    const tabsContainer = document.createElement('div');
    tabsContainer.className = 'flex border-b border-gray-200';

    const tabs = [
      { id: 'gallery', label: 'Gallery Template' },
      { id: 'request', label: 'Request Dokumen' },
      { id: 'mydocs', label: 'Dokumen Saya' },
    ];

    tabs.forEach(tab => {
      const tabBtn = document.createElement('button');
      tabBtn.textContent = tab.label;
      tabBtn.className = `flex-grow py-3 text-center font-semibold ${
        appState.currentDocumentTab === tab.id ? 'border-b-4 border-[#3F51B5] text-[#3F51B5]' : 'text-gray-600'
      } focus:outline-none`;
      tabBtn.addEventListener('click', () => {
        appState.currentDocumentTab = tab.id;
        renderApp();
      });
      tabsContainer.appendChild(tabBtn);
    });

    container.appendChild(tabsContainer);

    // Content area
    const content = document.createElement('div');
    content.className = 'p-4 flex-grow overflow-auto';

    if (appState.currentDocumentTab === 'gallery') {
      content.appendChild(renderDocumentGallery());
    } else if (appState.currentDocumentTab === 'request') {
      content.appendChild(renderDocumentRequest(user));
    } else if (appState.currentDocumentTab === 'mydocs') {
      content.appendChild(renderDocumentMyDocs(user));
    }

    container.appendChild(content);

    return container;
  }

  // Document gallery template
  function renderDocumentGallery() {
    const container = document.createElement('div');
    container.className = 'max-w-4xl mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6';

    const templates = [
      {
        id: 'template1',
        title: 'Surat Kuasa',
        desc: 'Template surat kuasa resmi dan legal.',
        thumbnail: 'https://placehold.co/400x250/png?text=Surat+Kuasa',
        fileUrl: '#',
      },
      {
        id: 'template2',
        title: 'Perjanjian Kerjasama',
        desc: 'Template perjanjian kerjasama bisnis.',
        thumbnail: 'https://placehold.co/400x250/png?text=Perjanjian+Kerjasama',
        fileUrl: '#',
      },
      {
        id: 'template3',
        title: 'Akta Pendirian PT',
        desc: 'Template akta pendirian perusahaan terbatas.',
        thumbnail: 'https://placehold.co/400x250/png?text=Akta+Pendirian+PT',
        fileUrl: '#',
      },
    ];

    templates.forEach(tpl => {
      const card = document.createElement('div');
      card.className = 'bg-white rounded shadow overflow-hidden flex flex-col';

      const img = document.createElement('img');
      img.src = tpl.thumbnail;
      img.alt = `Thumbnail template dokumen ${tpl.title}`;
      img.className = 'w-full h-40 object-cover';

      const content = document.createElement('div');
      content.className = 'p-4 flex flex-col flex-grow';

      const title = document.createElement('h3');
      title.textContent = tpl.title;
      title.className = 'font-semibold text-[#3F51B5] mb-2';

      const desc = document.createElement('p');
      desc.textContent = tpl.desc;
      desc.className = 'text-gray-600 flex-grow';

      const btn = document.createElement('a');
      btn.textContent = 'Download';
      btn.href = tpl.fileUrl;
      btn.className = 'mt-4 self-start bg-[#FFD700] text-[#3F51B5] font-semibold px-4 py-2 rounded hover:bg-[#e6c200] transition focus:outline-none';
      btn.setAttribute('download', '');
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        alert(`Download template: ${tpl.title} (fitur download belum tersedia)`);
      });

      content.appendChild(title);
      content.appendChild(desc);
      content.appendChild(btn);

      card.appendChild(img);
      card.appendChild(content);

      container.appendChild(card);
    });

    return container;
  }

  // Document request form
  function renderDocumentRequest(user) {
    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto';

    const form = document.createElement('form');
    form.className = 'space-y-5';

    // Pilih jenis dokumen
    const jenisGroup = document.createElement('div');
    const jenisLabel = document.createElement('label');
    jenisLabel.textContent = 'Pilih Jenis Dokumen';
    jenisLabel.className = 'block mb-1 font-semibold';
    const jenisSelect = document.createElement('select');
    jenisSelect.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5]';
    jenisSelect.required = true;
    ['Surat Kuasa', 'Perjanjian Kerjasama', 'Akta Pendirian PT', 'Lainnya'].forEach(jenis => {
      const option = document.createElement('option');
      option.value = jenis;
      option.textContent = jenis;
      jenisSelect.appendChild(option);
    });
    jenisGroup.appendChild(jenisLabel);
    jenisGroup.appendChild(jenisSelect);

    // Input detail
    const detailGroup = document.createElement('div');
    const detailLabel = document.createElement('label');
    detailLabel.textContent = 'Detail Dokumen';
    detailLabel.className = 'block mb-1 font-semibold';
    const detailTextarea = document.createElement('textarea');
    detailTextarea.rows = 4;
    detailTextarea.placeholder = 'Masukkan detail dokumen yang diinginkan';
    detailTextarea.className = 'w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#3F51B5] resize-none';
    detailTextarea.required = true;
    detailGroup.appendChild(detailLabel);
    detailGroup.appendChild(detailTextarea);

    // Submit button
    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Request';
    submitBtn.className = 'w-full bg-[#3F51B5] text-white font-semibold py-2 rounded hover:bg-[#334296] transition flex justify-center items-center';
    const spinner = document.createElement('span');
    spinner.className = 'hidden spinner-border spinner-border-sm animate-spin ml-2 border-2 border-white border-t-transparent rounded-full w-5 h-5';
    submitBtn.appendChild(spinner);

    form.appendChild(jenisGroup);
    form.appendChild(detailGroup);
    form.appendChild(submitBtn);

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      if (!jenisSelect.value) {
        alert('Jenis dokumen wajib dipilih.');
        return;
      }
      if (!detailTextarea.value.trim()) {
        alert('Detail dokumen wajib diisi.');
        return;
      }

      submitBtn.disabled = true;
      spinner.classList.remove('hidden');

      setTimeout(() => {
        const doc = {
          id: generateId('doc_'),
          userId: user.id,
          type: jenisSelect.value,
          detail: detailTextarea.value.trim(),
          status: 'pending',
          requestedAt: new Date().toISOString(),
        };
        appState.documents.push(doc);
        saveDocuments();
        alert('Request dokumen berhasil! Kami akan memprosesnya.');
        form.reset();
        submitBtn.disabled = false;
        spinner.classList.add('hidden');
      }, 1200);
    });

    container.appendChild(form);

    return container;
  }

  // Document my documents list
  function renderDocumentMyDocs(user) {
    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto';

    const title = document.createElement('h2');
    title.textContent = 'Dokumen Saya';
    title.className = 'text-lg font-semibold text-[#3F51B5] mb-4 text-center';
    container.appendChild(title);

    // Filter documents by user
    const userDocs = appState.documents.filter(d => d.userId === user.id);

    if (userDocs.length === 0) {
      const emptyMsg = document.createElement('p');
      emptyMsg.textContent = 'Belum ada dokumen.';
      emptyMsg.className = 'text-center text-gray-600 mt-6';
      container.appendChild(emptyMsg);
      return container;
    }

    const list = document.createElement('ul');
    list.className = 'space-y-4';

    userDocs.forEach(doc => {
      const item = document.createElement('li');
      item.className = 'bg-white rounded shadow p-4 flex flex-col';

      const title = document.createElement('p');
      title.textContent = `Jenis: ${doc.type || doc.aktaType || 'Dokumen'}`;
      title.className = 'font-semibold text-[#3F51B5] mb-1';

      const detail = document.createElement('p');
      detail.textContent = `Detail: ${doc.detail || doc.data || '-'}`;
      detail.className = 'mb-1';

      const status = document.createElement('p');
      status.textContent = `Status: ${doc.status}`;
      status.className = 'font-semibold';

      item.appendChild(title);
      item.appendChild(detail);
      item.appendChild(status);

      list.appendChild(item);
    });

    container.appendChild(list);

    return container;
  }

  // Profile page
  function renderProfile() {
    const user = getCurrentUser();
    if (!user) {
      navigateTo('login');
      return document.createElement('div');
    }

    const container = document.createElement('div');
    container.className = 'max-w-md mx-auto p-6 bg-white rounded shadow mt-12 mb-12';

    const title = document.createElement('h1');
    title.textContent = 'Profil Saya';
    title.className = 'text-3xl font-bold text-[#3F51B5] mb-6 text-center';

    const infoList = document.createElement('ul');
    infoList.className = 'space-y-4 text-gray-700';

    const items = [
      { label: 'Nama Lengkap', value: user.name },
      { label: 'Email', value: user.email || '-' },
      { label: 'Nomor Telepon', value: user.phone || '-' },
      { label: 'Jenis Pengguna', value: user.role.charAt(0).toUpperCase() + user.role.slice(1) },
    ];

    items.forEach(item => {
      const li = document.createElement('li');
      li.className = 'flex justify-between border-b border-gray-200 pb-2';
      const label = document.createElement('span');
      label.className = 'font-semibold';
      label.textContent = item.label;
      const value = document.createElement('span');
      value.textContent = item.value;
      li.appendChild(label);
      li.appendChild(value);
      infoList.appendChild(li);
    });

    container.appendChild(title);
    container.appendChild(infoList);

    // Back button
    const backBtn = document.createElement('button');
    backBtn.textContent = 'Kembali';
    backBtn.className = 'mt-6 bg-[#3F51B5] text-white font-semibold py-2 px-4 rounded hover:bg-[#334296] transition focus:outline-none';
    backBtn.addEventListener('click', () => {
      navigateTo('main');
    });

    container.appendChild(backBtn);

    return container;
  }

  // History page (Riwayat Konsultasi)
  function renderHistory() {
    const user = getCurrentUser();
    if (!user) {
      navigateTo('login');
      return document.createElement('div');
    }

    const container = document.createElement('div');
    container.className = 'max-w-lg mx-auto p-6 bg-white rounded shadow mt-12 mb-12';

    const title = document.createElement('h1');
    title.textContent = 'Riwayat Konsultasi';
    title.className = 'text-3xl font-bold text-[#3F51B5] mb-6 text-center';

    container.appendChild(title);

    // Filter appointments by user
    const userAppts = appState.appointments.filter(a => a.userId === user.id);

    if (userAppts.length === 0) {
      const emptyMsg = document.createElement('p');
      emptyMsg.textContent = 'Belum ada riwayat konsultasi.';
      emptyMsg.className = 'text-center text-gray-600 mt-6';
      container.appendChild(emptyMsg);
      return container;
    }

    const list = document.createElement('ul');
    list.className = 'space-y-4';

    userAppts.forEach(appt => {
      const item = document.createElement('li');
      item.className = 'bg-white rounded shadow p-4 flex flex-col';

      const dateTime = document.createElement('p');
      dateTime.textContent = `Tanggal: ${appt.date}, Waktu: ${appt.time}`;
      dateTime.className = 'font-semibold text-[#3F51B5] mb-1';

      const caseType = document.createElement('p');
      caseType.textContent = `Jenis Kasus: ${appt.caseType}`;
      caseType.className = 'mb-1';

      const desc = document.createElement('p');
      desc.textContent = `Deskripsi: ${appt.description}`;
      desc.className = 'mb-1';

      const status = document.createElement('p');
      status.textContent = `Status: ${appt.status}`;
      status.className = 'font-semibold';

      item.appendChild(dateTime);
      item.appendChild(caseType);
      item.appendChild(desc);
      item.appendChild(status);

      list.appendChild(item);
    });

    container.appendChild(list);

    // Back button
    const backBtn = document.createElement('button');
    backBtn.textContent = 'Kembali';
    backBtn.className = 'mt-6 bg-[#3F51B5] text-white font-semibold py-2 px-4 rounded hover:bg-[#334296] transition focus:outline-none';
    backBtn.addEventListener('click', () => {
      navigateTo('main');
    });

    container.appendChild(backBtn);

    return container;
  }

  // Render app based on current page
  function renderApp() {
    const app = document.getElementById('app');
    app.innerHTML = '';

    let pageContent;

    switch (appState.currentPage) {
      case 'splash':
        pageContent = renderSplash();
        break;
      case 'onboarding':
        pageContent = renderOnboarding();
        break;
      case 'login':
        pageContent = renderLogin();
        break;
      case 'register':
        pageContent = renderRegister();
        break;
      case 'main':
        pageContent = renderMain();
        break;
      case 'consultation':
        pageContent = renderConsultation();
        break;
      case 'notaris':
        pageContent = renderNotaris();
        break;
      case 'documents':
        pageContent = renderDocuments();
        break;
      case 'profile':
        pageContent = renderProfile();
        break;
      case 'history':
        pageContent = renderHistory();
        break;
      default:
        pageContent = document.createElement('div');
        pageContent.textContent = 'Halaman tidak ditemukan.';
    }

    app.appendChild(pageContent);
  }

  // Initialize app
  function init() {
    loadInitialData();

    if (appState.session) {
      appState.currentPage = 'main';
    } else {
      appState.currentPage = 'splash';
    }

    renderApp();
    resetInactivityTimer();
  }

  // Start app
  init();

  // Back button handling (browser back)
  window.addEventListener('popstate', (e) => {
    // For simplicity, do nothing or reload main page
    if (appState.session) {
      navigateTo('main');
    } else {
      navigateTo('login');
    }
  });

})();
</script>

</body>
</html>
